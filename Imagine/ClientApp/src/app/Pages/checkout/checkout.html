<section class="checkout-page">
  <div class="checkout-background">
    <div class="checkout-orb orb-left"></div>
    <div class="checkout-orb orb-right"></div>
    <div class="checkout-grid"></div>
  </div>

  <div class="container position-relative">
    <div class="row mb-4">
      <div class="col-12 text-center">
        <p class="badge-text">Secure checkout</p>
        <h2 class="checkout-title">
          Confirm your
          <span class="highlight">order</span>
        </h2>
        <p class="checkout-subtitle">
          Review your items and share your shipping details. We&apos;ll take care of the rest.
        </p>
      </div>
    </div>

    <div class="row g-4 align-items-start">
      <div class="col-lg-7">
        <div class="checkout-card checkout-form-card glass">
          <h3 class="card-title">Shipping details</h3>
          <p class="card-subtitle">We&apos;ll use this information to deliver your AI-powered products.</p>

          <form #checkoutForm="ngForm" (ngSubmit)="onSubmit(checkoutForm)" novalidate>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Full name<span class="required">*</span></label>
                <input
                  type="text"
                  name="fullName"
                  class="form-control"
                  [(ngModel)]="model.fullName"
                  #fullName="ngModel"
                  required
                />
                <div class="field-error" *ngIf="fullName.invalid && fullName.touched">
                  Please enter your full name.
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Phone number<span class="required">*</span></label>
                <input
                  type="tel"
                  name="phoneNumber"
                  class="form-control"
                  [(ngModel)]="model.phoneNumber"
                  #phoneNumber="ngModel"
                  required
                />
                <div class="field-error" *ngIf="phoneNumber.invalid && phoneNumber.touched">
                  Please enter a valid phone number.
                </div>
              </div>

              <div class="col-12">
                <label class="form-label">Address<span class="required">*</span></label>
                <input
                  type="text"
                  name="address"
                  class="form-control"
                  [(ngModel)]="model.address"
                  #address="ngModel"
                  required
                />
                <div class="field-error" *ngIf="address.invalid && address.touched">
                  Please enter your full shipping address.
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label">City<span class="required">*</span></label>
                <input
                  type="text"
                  name="city"
                  class="form-control"
                  [(ngModel)]="model.city"
                  #city="ngModel"
                  required
                />
                <div class="field-error" *ngIf="city.invalid && city.touched">
                  Please enter your city.
                </div>
              </div>

              <div class="col-12">
                <label class="form-label">Notes (optional)</label>
                <textarea
                  name="notes"
                  class="form-control notes-textarea"
                  rows="3"
                  [(ngModel)]="model.notes"
                ></textarea>
              </div>
            </div>

            <div class="form-footer mt-4 d-flex justify-content-between align-items-center">
              <p class="secure-text mb-0">
                <i class="fas fa-lock"></i>
                Your details are encrypted and processed securely.
              </p>

              <button
                class="btn btn-primary-custom"
                type="submit"
                [disabled]="submitting || !hasItems"
              >
                <span *ngIf="!submitting">Place order</span>
                <span *ngIf="submitting" class="spinner-border spinner-border-sm" role="status"></span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="col-lg-5">
        <div class="checkout-card checkout-summary-card glass">
          <h3 class="card-title">Order summary</h3>
          <p class="card-subtitle" *ngIf="hasItems; else emptyCartText">
            {{ itemCount }} item(s) in your cart.
          </p>

          <ng-template #emptyCartText>
            <p class="card-subtitle">Your cart is empty right now.</p>
          </ng-template>

          <div class="items-list" *ngIf="hasItems">
            <div class="summary-item" *ngFor="let item of items">
              <div class="item-main">
                <div class="item-title-row">
                  <span class="item-name">{{ item.name }}</span>
                  <span class="item-total">{{ item.basePrice * item.quantity | currency:'EGP':'code' }}</span>
                </div>
                <div class="item-meta">
                  <span class="pill">Qty {{ item.quantity }}</span>
                  <span class="pill" *ngIf="item.color">Color: {{ item.color }}</span>
                  <span class="pill" *ngIf="item.size">Size: {{ item.size }}</span>
                  <span class="pill ai-pill" *ngIf="item.isAiPowered">AI design</span>
                </div>
                <div class="item-price-row">
                  <span>Price per item</span>
                  <span>{{ item.basePrice | currency:'EGP':'code' }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-row">
            <span>Subtotal</span>
            <span>{{ subtotal | currency:'EGP':'code' }}</span>
          </div>
          <div class="summary-row">
            <span>Tax</span>
            <span>{{ tax | currency:'EGP':'code' }}</span>
          </div>
          <div class="summary-row">
            <span>Shipping</span>
            <span *ngIf="shipping > 0">{{ shipping | currency:'EGP':'code' }}</span>
            <span *ngIf="shipping === 0">Free</span>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-row summary-total">
            <span>Total</span>
            <span>{{ total | currency:'EGP':'code' }}</span>
          </div>

          <p class="ghost-text mt-3">
            After placing your order, you&apos;ll be redirected to your client dashboard to review its status.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>
