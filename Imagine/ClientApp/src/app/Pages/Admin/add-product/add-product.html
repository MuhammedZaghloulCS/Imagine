<!-- Add Product Page -->
<div class="add-product-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button class="btn-back" (click)="onCancel()">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="header-text">
          <h1 class="page-title">{{ isEditMode ? 'Edit Product' : 'Add New Product' }}</h1>
          <p class="page-subtitle">
            {{
              isEditMode
                ? 'Update product details and variants'
                : 'Create a new product with colors and variants'
            }}
          </p>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn-cancel" (click)="onCancel()">
          <i class="fas fa-times"></i>
          Cancel
        </button>
        <button class="btn-save" (click)="onSave()" [disabled]="!isFormValid()">
          <i class="fas fa-save"></i>
          {{ isEditMode ? 'Update Product' : 'Save Product' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="page-content">
    <div class="content-grid">
      <!-- Left Column - Form Sections -->
      <div class="form-column">
        <!-- Basic Information Section -->
        <div class="form-section">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-info-circle"></i>
              Basic Information
            </h2>
            <p class="section-description">Essential product details and pricing</p>
          </div>

          <div class="section-content">
            <div class="form-row">
              <div class="form-group full-width">
                <label class="form-label">
                  <i class="fas fa-box"></i>
                  Product Name *
                </label>
                <input
                  type="text"
                  class="form-input"
                  [(ngModel)]="product.name"
                  placeholder="e.g., Premium Wireless Headphones"
                />
              </div>
            </div>

            <!-- Available Sizes Section -->
            <div class="form-group full-width">
              <label class="form-label">
                <i class="fas fa-ruler-combined"></i>
                Available Sizes
              </label>
              <div class="sizes-container">
                <div class="sizes-list">
                  <button
                    type="button"
                    class="size-chip"
                    *ngFor="let size of allSizes"
                    [class.selected]="isSizeSelected(size)"
                    (click)="toggleSize(size)"
                  >
                    {{ size }}
                  </button>
                </div>

                <div class="sizes-selected" *ngIf="selectedSizes.length > 0">
                  <span class="sizes-label">Selected:</span>
                  <div class="sizes-tags">
                    <span class="size-tag" *ngFor="let size of selectedSizes">
                      {{ size }}
                      <button type="button" class="tag-remove" (click)="toggleSize(size)">
                        <i class="fas fa-times"></i>
                      </button>
                    </span>
                  </div>
                </div>

                <div class="sizes-empty" *ngIf="selectedSizes.length === 0">
                  <span>No sizes selected yet.</span>
                </div>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-tags"></i>
                  Category *
                </label>
                <select
                  class="form-select"
                  [(ngModel)]="product.categoryId"
                  (ngModelChange)="onCategoryChange($event)"
                >
                  <option [value]="0">Select Category</option>
                  <option *ngFor="let category of categories" [value]="category.id">
                    {{ category.name }}
                  </option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-dollar-sign"></i>
                  Base Price *
                </label>
                <div class="price-input-wrapper">
                  <span class="price-prefix">EGP</span>
                  <input
                    type="number"
                    class="form-input price-input"
                    [(ngModel)]="product.basePrice"
                    placeholder="0.00"
                    step="0.01"
                    min="0"
                  />
                </div>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-align-left"></i>
                Description
              </label>
              <textarea
                class="form-textarea"
                rows="4"
                [(ngModel)]="product.description"
                placeholder="Describe your product features and benefits..."
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="product.isActive" class="checkbox-input" />
                  <span class="checkbox-custom"></span>
                  <span class="checkbox-text">
                    <i class="fas fa-eye"></i>
                    Active (Visible to customers)
                  </span>
                </label>
              </div>

              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="product.isFeatured" class="checkbox-input" />
                  <span class="checkbox-custom"></span>
                  <span class="checkbox-text">
                    <i class="fas fa-star"></i>
                    Featured Product
                  </span>
                </label>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="product.isPopular" class="checkbox-input" />
                  <span class="checkbox-custom"></span>
                  <span class="checkbox-text">
                    <i class="fas fa-fire"></i>
                    Popular Product
                  </span>
                </label>
              </div>

              <div class="form-group">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="product.isLatest" class="checkbox-input" />
                  <span class="checkbox-custom"></span>
                  <span class="checkbox-text">
                    <i class="fas fa-sparkles"></i>
                    Latest Drop
                  </span>
                </label>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group full-width">
                <label class="checkbox-label">
                  <input type="checkbox" [(ngModel)]="product.allowAiCustomization" class="checkbox-input">
                  <span class="checkbox-custom"></span>
                  <span class="checkbox-text">
                    <i class="fas fa-robot"></i>
                    Allow AI Customization
                  </span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Product Image Section -->
        <div class="form-section">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-image"></i>
              Main Product Image
            </h2>
            <p class="section-description">Primary image shown in product listings</p>
          </div>

          <div class="section-content">
            <div class="main-image-upload">
              <div class="upload-area" *ngIf="!mainImagePreview" (click)="triggerMainImageInput()">
                <i class="fas fa-cloud-upload-alt"></i>
                <p class="upload-text">Click to upload main product image</p>
                <span class="upload-hint">PNG, JPG up to 5MB</span>
                <input
                  #mainImageInput
                  type="file"
                  class="file-input"
                  accept="image/*"
                  (change)="onMainImageSelected($event)"
                />
              </div>

              <div class="image-preview" *ngIf="mainImagePreview">
                <img [src]="mainImagePreview" alt="Main product image" />
                <div class="image-overlay">
                  <button class="btn-change" (click)="triggerMainImageInput()">
                    <i class="fas fa-edit"></i>
                    Change
                  </button>
                  <button class="btn-remove" (click)="clearMainImage()">
                    <i class="fas fa-trash"></i>
                    Remove
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Product Colors Section -->
        <div class="form-section">
          <div class="section-header">
            <h2 class="section-title">
              <i class="fas fa-palette"></i>
              Product Colors & Variants
            </h2>
            <p class="section-description">Manage color variations, pricing, and stock</p>
          </div>

          <div class="section-content">
            <!-- Colors List -->
            <div class="colors-container">
              <div class="colors-header">
                <h3 class="colors-title">Color Variants ({{ product.colors.length }})</h3>
                <button class="btn-add-color" (click)="addNewColor()">
                  <i class="fas fa-plus"></i>
                  Add Color
                </button>
              </div>

              <!-- Color Items -->
              <div class="colors-list" *ngIf="product.colors.length > 0">
                <div
                  class="color-item"
                  *ngFor="let color of product.colors; let i = index"
                  [class.active]="selectedColorIndex === i"
                  (click)="selectColor(i)"
                >
                  <div class="color-preview">
                    <div class="color-swatch" [style.background-color]="color.colorHex"></div>
                    <div class="color-info">
                      <h4 class="color-name">{{ color.colorName || 'Unnamed Color' }}</h4>
                      <p class="color-details">
                        Stock: {{ color.stock }} | Price:
                        {{ getTotalPrice(product.basePrice, color.additionalPrice) }}
                      </p>
                    </div>
                  </div>

                  <div class="color-actions">
                    <span class="color-status" [class.available]="color.isAvailable">
                      <i class="fas fa-circle"></i>
                      {{ color.isAvailable ? 'Available' : 'Unavailable' }}
                    </span>
                    <button
                      class="btn-remove-color"
                      (click)="removeColor(i); $event.stopPropagation()"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Empty State -->
              <div class="colors-empty" *ngIf="product.colors.length === 0">
                <i class="fas fa-palette"></i>
                <p>No color variants added yet</p>
                <button class="btn-add-first-color" (click)="addNewColor()">
                  <i class="fas fa-plus"></i>
                  Add Your First Color
                </button>
              </div>
            </div>

            <!-- Selected Color Details -->
            <div
              class="color-details-panel"
              *ngIf="selectedColorIndex >= 0 && product.colors[selectedColorIndex]"
            >
              <div class="panel-header">
                <h3 class="panel-title">
                  <i class="fas fa-edit"></i>
                  Edit Color: {{ product.colors[selectedColorIndex].colorName || 'Unnamed' }}
                </h3>
              </div>

              <div class="panel-content">
                <!-- Color Basic Info -->
                <div class="color-form">
                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-tag"></i>
                        Color Name *
                      </label>
                      <input
                        type="text"
                        class="form-input"
                        [(ngModel)]="product.colors[selectedColorIndex].colorName"
                        placeholder="e.g., Midnight Black"
                      />
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-eye-dropper"></i>
                        Color Code
                      </label>
                      <div class="color-picker-group">
                        <input
                          type="color"
                          class="color-picker"
                          [(ngModel)]="product.colors[selectedColorIndex].colorHex"
                        />
                        <input
                          type="text"
                          class="form-input color-hex"
                          [(ngModel)]="product.colors[selectedColorIndex].colorHex"
                          placeholder="#000000"
                        />
                      </div>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-cubes"></i>
                        Stock Quantity
                      </label>
                      <input
                        type="number"
                        class="form-input"
                        [(ngModel)]="product.colors[selectedColorIndex].stock"
                        placeholder="0"
                        min="0"
                      />
                    </div>

                    <div class="form-group">
                      <label class="form-label">
                        <i class="fas fa-plus-circle"></i>
                        Additional Price
                      </label>
                      <input
                        type="number"
                        class="form-input"
                        [(ngModel)]="product.colors[selectedColorIndex].additionalPrice"
                        placeholder="0.00"
                        step="0.01"
                      />
                    </div>

                    <div class="form-group">
                      <label class="checkbox-label">
                        <input
                          type="checkbox"
                          [(ngModel)]="product.colors[selectedColorIndex].isAvailable"
                          class="checkbox-input"
                        />
                        <span class="checkbox-custom"></span>
                        <span class="checkbox-text">
                          <i class="fas fa-check-circle"></i>
                          Available for Purchase
                        </span>
                      </label>
                    </div>
                  </div>
                </div>

                <!-- Color Images -->
                <div class="color-images-section">
                  <div class="images-header">
                    <h4 class="images-title">
                      <i class="fas fa-images"></i>
                      Color Images ({{ product.colors[selectedColorIndex].images.length }})
                    </h4>
                    <button class="btn-add-images" (click)="triggerColorImageInput()">
                      <i class="fas fa-plus"></i>
                      Add Images
                    </button>
                    <input
                      #colorImageInput
                      type="file"
                      class="file-input"
                      accept="image/*"
                      multiple
                      (change)="onColorImageSelected($event, selectedColorIndex)"
                    />
                  </div>

                  <!-- Images Grid -->
                  <div
                    class="images-grid"
                    *ngIf="product.colors[selectedColorIndex].images.length > 0"
                  >
                    <div
                      class="image-item"
                      *ngFor="
                        let image of product.colors[selectedColorIndex].images;
                        let imgIndex = index
                      "
                      [class.main]="image.isMain"
                    >
                      <div class="image-container">
                        <img [src]="image.imageUrl" [alt]="image.altText" />
                        <div class="image-overlay">
                          <button
                            class="btn-set-main"
                            *ngIf="!image.isMain"
                            (click)="setMainColorImage(selectedColorIndex, imgIndex)"
                            title="Set as main image"
                          >
                            <i class="fas fa-star"></i>
                          </button>
                          <button
                            class="btn-remove-image"
                            (click)="removeColorImage(selectedColorIndex, imgIndex)"
                            title="Remove image"
                          >
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                        <div class="main-badge" *ngIf="image.isMain">
                          <i class="fas fa-star"></i>
                          Main
                        </div>
                      </div>

                      <div class="image-info">
                        <input
                          type="text"
                          class="image-alt"
                          [(ngModel)]="image.altText"
                          placeholder="Alt text for accessibility"
                        />
                      </div>
                    </div>
                  </div>

                  <!-- Images Empty State -->
                  <div
                    class="images-empty"
                    *ngIf="product.colors[selectedColorIndex].images.length === 0"
                  >
                    <i class="fas fa-images"></i>
                    <p>No images added for this color</p>
                    <button class="btn-add-first-image" (click)="triggerColorImageInput()">
                      <i class="fas fa-plus"></i>
                      Add Images
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column - Live Preview -->
      <div class="preview-column">
        <div class="preview-panel">
          <div class="preview-header">
            <h3 class="preview-title">
              <i class="fas fa-eye"></i>
              Live Preview
            </h3>
            <p class="preview-subtitle">How your product will appear to customers</p>
          </div>

          <div class="preview-content">
            <!-- Product Card Preview -->
            <div class="product-preview-card">
              <div class="preview-image">
                <img
                  [src]="mainImagePreview || '/assets/images/product-placeholder.jpg'"
                  alt="Product preview"
                />
                <div class="preview-badges" *ngIf="product.isFeatured">
                  <span class="badge-featured">Featured</span>
                </div>
              </div>

              <div class="preview-info">
                <h4 class="preview-name">{{ product.name || 'Product Name' }}</h4>
                <p class="preview-description">
                  {{ product.description || 'Product description will appear here...' }}
                </p>

                <div class="preview-price">
                  <span class="base-price">{{ formatPrice(product.basePrice) }}</span>
                  <span class="price-range" *ngIf="product.colors.length > 0">
                    - {{ formatPrice(product.basePrice + getMaxAdditionalPrice()) }}
                  </span>
                </div>

                <div class="preview-colors" *ngIf="product.colors.length > 0">
                  <span class="colors-label">Available Colors:</span>
                  <div class="color-swatches">
                    <div
                      class="color-swatch-mini"
                      *ngFor="let color of product.colors"
                      [style.background-color]="color.colorHex"
                      [title]="color.colorName"
                    ></div>
                  </div>
                </div>

                <div class="preview-status">
                  <span class="status-badge" [class.active]="product.isActive">
                    <i class="fas fa-circle"></i>
                    {{ product.isActive ? 'Active' : 'Inactive' }}
                  </span>
                </div>
              </div>
            </div>

            <!-- Color Variants Summary -->
            <div class="variants-summary" *ngIf="product.colors.length > 0">
              <h4 class="summary-title">Color Variants Summary</h4>
              <div class="variant-list">
                <div class="variant-item" *ngFor="let color of product.colors">
                  <div class="variant-color">
                    <div class="variant-swatch" [style.background-color]="color.colorHex"></div>
                    <span class="variant-name">{{ color.colorName }}</span>
                  </div>
                  <div class="variant-details">
                    <span class="variant-stock">{{ color.stock }} in stock</span>
                    <span class="variant-price">{{
                      getTotalPrice(product.basePrice, color.additionalPrice)
                    }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
